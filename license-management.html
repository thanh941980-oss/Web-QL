<!DOCTYPE html><html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Qu·∫£n l√Ω b·∫£n quy·ªÅn</title>
  <style>
    body {font-family: Arial, sans-serif; background:#f4f6f8; margin:0; padding:20px;}
    h1 {text-align:center; margin-bottom:20px;}
    .form-container, .table-container {background:#fff; padding:20px; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.1); margin-bottom:20px;}
    .form-group {margin-bottom:15px;}
    label {display:block; margin-bottom:5px; font-weight:bold;}
    input {width:100%; padding:8px; border:1px solid #ccc; border-radius:4px;}
    button {padding:10px 15px; background:#3498db; color:#fff; border:none; border-radius:4px; cursor:pointer;}
    button:hover {background:#2980b9;}
    table {width:100%; border-collapse:collapse; margin-top:10px;}
    th,td {border:1px solid #ddd; padding:10px; text-align:left;}
    th {background:#f2f2f2;}
    .key-used {background:#d4edda;}
    .key-unused {background:#fff3cd;}
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
</head>
<body>
<h1>Qu·∫£n l√Ω m√£ b·∫£n quy·ªÅn</h1><div class="form-container">
  <h3>üìù T·∫°o m√£ b·∫£n quy·ªÅn m·ªõi</h3>
  <div class="form-group">
    <label for="keyCount">S·ªë l∆∞·ª£ng m√£</label>
    <input type="number" id="keyCount" value="5" min="1" max="1000">
  </div>
  <div class="form-group">
    <label for="keyLength">ƒê·ªô d√†i m√£ (6-20 k√Ω t·ª±)</label>
    <input type="number" id="keyLength" value="8" min="6" max="20">
  </div>
  <button id="generateBtn">T·∫°o m√£</button>
</div><div class="table-container">
  <h3>üìã Danh s√°ch m√£ b·∫£n quy·ªÅn</h3>
  <div id="keysTable"></div>
</div><script>
const firebaseConfig = {
  apiKey: "AIzaSyB7qqxKGsD-enKgzeAvGQ8CwtTsFWy01OM",
  authDomain: "web-quan-ly.firebaseapp.com",
  databaseURL: "https://web-quan-ly-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "web-quan-ly",
  storageBucket: "web-quan-ly.firebasestorage.app",
  messagingSenderId: "623183081841",
  appId: "1:623183081841:web:72cee8d908d383b65e46d0"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const database = firebase.database();

// üîë ƒêƒÉng nh·∫≠p ·∫©n danh ƒë·ªÉ c√≥ quy·ªÅn auth != null
auth.signInAnonymously().catch(err => console.error("L·ªói ƒëƒÉng nh·∫≠p ·∫©n danh:", err));

// H√†m t·∫°o key ng·∫´u nhi√™n
function generateKey(len=8){
  const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
  let res = "";
  for(let i=0;i<len;i++) res += chars.charAt(Math.floor(Math.random()*chars.length));
  return res;
}

// T·∫°o v√† l∆∞u key
async function createKeys(){
  const count = parseInt(document.getElementById('keyCount').value)||1;
  const length = parseInt(document.getElementById('keyLength').value)||8;
  const timestamp = new Date().toISOString();

  for(let i=0;i<count;i++){
    const key = generateKey(length);
    const data = { generatedAt: timestamp, used:false, usedAt:null };
    await database.ref('licenseKeys/'+key).set(data);
  }
  loadKeys();
}

document.getElementById('generateBtn').addEventListener('click', createKeys);

// Hi·ªÉn th·ªã key
function loadKeys(){
  database.ref('licenseKeys').on('value', snap => {
    if(!snap.exists()){ document.getElementById('keysTable').innerHTML = '<p>Ch∆∞a c√≥ m√£ n√†o.</p>'; return; }
    const keys = snap.val();
    let html = `<table><thead><tr><th>M√£</th><th>Tr·∫°ng th√°i</th><th>Ng√†y t·∫°o</th><th>Ng√†y c·∫•p</th></tr></thead><tbody>`;
    Object.entries(keys).forEach(([k,v])=>{
      html += `<tr class="${v.used?'key-used':'key-unused'}">
        <td><code>${k}</code></td>
        <td>${v.used?'‚úÖ ƒê√£ c·∫•p':'üîÑ Ch∆∞a c·∫•p'}</td>
        <td>${v.generatedAt?new Date(v.generatedAt).toLocaleDateString('vi-VN'):'---'}</td>
        <td>${v.usedAt?new Date(v.usedAt).toLocaleDateString('vi-VN'):'---'}</td>
      </tr>`;
    });
    html += `</tbody></table>`;
    document.getElementById('keysTable').innerHTML = html;
  });
}

loadKeys();
</script></body>
</html>
